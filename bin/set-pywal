#!/usr/bin/bash
shopt -s extglob

declare -r myname='set-pywal'
declare -r myver='1.1.1'

# Verifies if 'python-pywal' is installed
if ! type "wal" >> /dev/null 2>&1; then
    echo -e \
        "\nThis script requires 'python-pywal' to be installed\n" \
        "\rPlease install it and rerun this script."
fi


# Verifies if 'variety' is installed
if ! type "variety" >> /dev/null 2>&1; then
    echo -e \
        "\nThis script requires 'variety' to be installed\n" \
        "\rPlease install it and rerun this script."
fi

if ! type "wal" >> /dev/null 2>&1 || ! type "variety" >> /dev/null 2>&1  ; then
    exit
fi

find-wallpaper(){
	current_wallpaper="$(cat $HOME/.config/variety/wallpaper/wallpaper.jpg.txt)"
}

otherApps(){
	walColorsForDunst
	walAlacritty
}

qtile-restart(){
	qtile-cmd -o cmd -f restart
}

i3-restart(){
	i3-msg restart
}

kscreenlockwal(){
	kwriteconfig5 --file kscreenlockerrc --group Greeter --group Wallpaper --group org.kde.image --group General --key Image "$current_wallpaper"
	echo "kde lock screen wallpaper changed"
}

restart-wm(){
	case "$1" in
		qtile) qtile-restart; exit;;
		i3) i3-restart; exit;;
		kde) kscreenlockwal; exit;;
	esac
}

set-wal(){
	find-wallpaper
	wal -i "$current_wallpaper"
	otherApps
	restart-wm $1
}
set-variety(){
	variety $1 &
	sleep 5
}
setwal() {
	case "$2" in
		-f) set-variety -f && set-wal $1 && exit;;
		-p) set-variety -p && set-wal $1 && exit;;
		-n) set-variety -n && set-wal $1 && exit;;
		-u) set-wal $1 && exit;;
	esac
}
# $1 is the wm(window manager eg. KDE, GNOME, Qtile, etc) name and $2 is the action (next, preivous, update)
setwal $1 $2
